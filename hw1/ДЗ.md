Описание/Пошаговая инструкция выполнения домашнего задания:

Попробуйте сделать несколько вариантов разбиений и попробуйте их оценить. Выберите вариант, который вы будете реализовывать.  
На выходе вы должны предоставить

1. Пользовательские сценарии
2. Общую схему взаимодействия сервисов.
3. Для каждого сервиса опишите назначение сервиса и его зону ответственности.
4. Опишите контракты взаимодействия сервисов друг с другом.


# Идея
Интернет аукцион. 
Продавец публикует товар на продажу (категория/описание/минимальная и ожидаемая стоимость продажи). Затем происходит этап оценки. После оценки товару присваивается категория/описание/оценка/базовая стоимость и период сбора заявок. (Оценка спроса на товар перед выставлением на торги). Товар выставляется на аукцион. Покупатели предлагают свою цену (диапазон цен) за которую они готовы купить товар.
1. Сумма холдируется на счете ? 
2. Заявку можно отозвать ?
3. Ограничение на количество заявок для защиты искусственного завышения цен.
4. Механизм выбора победителя
После завершения аукциона определяется победитель (с самой большой заявкой?)
Запрашивается подтверждение у победителя и продавца осуществить сделку по указанной цене. Если победитель отказывается выбирается следующий до тех пор пока будут заявки удовлетворяющие продавца.
Заключается сделка, вносятся средства, оформляется доставка, после подтверждения поставки средства переводятся покупателю.

# Участники
* Продавец
* Покупатель
* Оценщик
* Аукцион (площадка, торги, сделка)
* Сервис оплаты
* Сервис доставки

# Продавец
* Размещает товар, указывает категорию, описание, минимальную и желаемую сумму за которую он готов его продать
* Отправляет товар на оценку
* Предоставляет запрашиваемые для оценки документы и подтверждения
* Заключает сделку с победителем
* Отправляет товар
* Закрывает сделку и получает деньги

# Покупатель
* Выбирает товар для покупки и получает всю информацию по нему
* Размещает заявку на покупку, указывая минимальную и максимальную цену за которую он готов приобрести товар
* В случае победы 
	* заключает сделку
		* выбирает способ доставки
		* оплачивает товар
	* отказывается от сделки 

# Оценщик (опционально)
* Внешний сервис
* Получает заявку на размещение
* Проверяет корректность описания
* Запрашивает дополнительную информацию у продовца
* Привлекает дополнительных экспертов
* Формирует заключение и определяет цену

# Аукцион
* Предоставляет форму размещения товара
* Предоставляет форму оценки и запроса дополнительной информации
* Предоставляет форму проведения торгов по товару
* Определяет победителя
* Организует форму заключения сделки
	* Оплаты в два этапа через счет аукциона
	* Организует доставку товара
	* Удержание комиссии
* Предоставляет форму регистрации продовцов, покупателей и оценщиков
* Является гарантом заключения сделки по описанным правилам торгов

# Сервис оплаты
* внешний сервис
* принимает платеж от клиента
* переводит средства продавцу
* удерживает свою комиссию
* переводит комиссию аукциону

# Сервис доставки
* внешний сервис
* регистрируется доставка
* оплачивается
* информирует о статусе доставки


# Сервисы
* Товары - размещение, оценка
* Аукцион - отображение товаров, принятие заявок
* Сделка - заключение, оплата, доставка

[Escalidraw](https://excalidraw.com/#json=4-8_-ZhKoQwdq3XTeJ0_w,nyRzDCR3j-fuzYAEI4T7sg)

![[Доменная модель.png]]



**История**: Регистрация
Как **продавец**  **покупатель** **оценщик**
**Чтобы** совершить операцию на площадке
Я должен зарегестрироваться

**Дано** то, что я хочу воспользоваться услугами площадки
**Тогда** я захожу на сайт, нажимаю копку зарегистрироваться. Открывается форма ввода данных (имя, контактная информация, логин, пароль). После ввода я нажимаю кнопку сохранить. Меня возвращает на стартовую страницу.

**История**: Авторизация
Как **продавец**  **покупатель** **оценщик**
**Чтобы** совершить операцию на площадке
Я должен авторизоваться

**Дано** то, что у меня есть зарегистрированная учетная запись логин и пароль
**Тогда** я захожу на стартовую страницу, ввожу логин и пароль. **Если** они указаны корректно открывается главная страница. **Иначе** возвращается ошибка о не верном логине или пароле.


**История**: Размещение товара для продажи
Как **продавец**
**Чтобы** продать товар
Я хочу разместить его для продажи

**Дано** то, что у меня есть товар который хочу продать на аукционе и я авторизован на сайте
**Тогда** я завожу карточку товара. Добавляю фотографии, описание, минимальную цену за которую готов продать товар. Прикладываю документы по товару для подтверждения обоснованности цены. И отправляю заявку на размещение.

**История**: Отправка товара на оценку
Как **продавец**
**Чтобы** обосновать стоимость товара
Я хочу провести его экспертную оценку.

**Дано** то, что у меня есть карточка товара на аукционе и я авторизован на сайте
**Тогда** я захожу в карточку товара, нажимаю на кнопку провести оценку. Открывается страница с экспертами которые могут ее провести с оценками и стоимостью услуг. Я могу накладывать фильтры  и открывать страницы экспертов с примерами оценок и наличием лицензий на возможность проведения оценки.
Я выбираю эксперта и нажимаю кнопку отправить. В течении указанного на карточке времени эксперт должен связаться и проинформировать о времени предоставления заключения и запросить необходимые документы. Запрашиваемые документы будут подгружены в карточку товара. Заключение эксперта так же будет подгружено в карточку товара.


**История**: Коммуникация
Как **клиент** **оценщик** **аукцион**
**Чтобы** узнать больше о товаре
Я хочу общаться с **продавцом**.

**Дано** то, что есть размещенная карточка клиента и пользователь авторизованный под ролью **оценщика** **покупателя** **администратора аукциона**
**Когда** необходимо связаться с **продавцом**  я ввожу вопрос в форму чата на карточке товара. Чат может быть приватный или публичный. В чате сохраняются все сообщения.
**Тогда** продовец получает уведомление о сообщении в чате и может на него ответить

**История**: Поиск товара для покупки
Как **клиент**
**Чтобы** купить товар
Я хочу его найти и получить по нему информацию.

**Дано** то, авторизованный под ролью **покупателя** пользователь
**Когда** я хочу купить редкую монету
**Тогда** я захожу на сайт,  набираю в поиске "монеты XV века", отображаются карточки с монетами и текущей ценой лота. Я могу провалится в карточку чтобы узнать больше информации о лоте. Могу перейти к следующему лоту из выборки, уточнить запрос по предложенным тегам.

**История**: Размещение заявки на товар
Как **клиент**
**Чтобы** купить товар
Я хочу купить выбранный лот.

**Дано** то, авторизованный под ролью **покупателя** пользователь, открытая карточка лота
**Тогда** я нажимаю кнопку "разместить заявку", в заявке указываю желаемую стоимость и максимальную стоимость за которую я готов купить лот.


**История**: Отзыв заявки на товар
Как **клиент**
**Чтобы** отказаться от покупки товара
Я хочу отменить или скорректировать заявку выбранного лота.

**Дано** то, авторизованный под ролью **покупателя** пользователь, открытая карточка лота, торги еще не закрыты
**Тогда** я нажимаю кнопку "изменить заявку", в заявке указываю новую желаемую и максимальную стоимость и нажимаю "сохранить изменения" **Либо** нажимаю "отозвать заявку".   


**История**: Выбор победителя 
Как **продавец**
Я хочу продать по максимальной цене.
Как **покупатель**
Я хочу купить товар по минимальной стоимости.
Как **аукцион**
Я выступаю гарантом исполнения правил торгов

**Дано** то, лот для продажи и поступившие заявки
**Когда** наступает завершение торгов по сроку 
**Сценарий 1** подана хотя бы одна заявка
**Тогда** аукцион производит выбор победителя. Алгоритм выбора:
Выбрать заявку с самой большой заявленой сумой. Сумму сделки определить как максимальную сумму 2 по очереди сделки +1 рубль. Если сумма оказывается меньше желаемой продавцом, а максимальная сумма заявки превышает то берется желаемая сумма продавца. Если максимальная сумма оказывается меньше то берется максимальная сумма лота.
**Сценарий 2** не подано ни одной заявки
**Тогда** аукцион считается не состоявшимся

**История**: Заключение сделки 
Как **продавец** **покупатель** и **аукцион**
Мы заинтересованы в совершении сделки.

**Дано** то, лот для продажи, определен победитль
**Тогда** аукцион информирует победителя и продавца о выигравшем лоте и итоговой сумме сделки.

**Сценарий 1**
Победитель и продавец подтверждают сделку нажатием на кнопку подтвердить сделку.
Покупатель выбирает способ доставки товара у партнера доступного в списке.
Оплачивает сумму лота и стоимость доставки.
Продавец подтверждает способ доставки.
Продавец формирует доставку и регистрирует ее в карточке лота для отслеживания.
**Когда** статус заявки переходит в статус доставлен сделка считается завершенной и закрывается. **Если** в течении 10 дней от покупателя не поступило претензии по товару происходит перевод средств продавцу. 

**Сценарий 2**
Победитель отвергает сделку указывая причину отказа. Информируется продавец об отказа **покупателя** с отображением причины. Клиент попадает в бан на дальнейшие торги. Анализируется причина отказа и в случае проблемы с лотом бан может быть снят.
Выбирается новый победить из заявок.

**Сценарий 3**
Продавец отвергает сделку. Информируется победитель об отказе продавца с причиной отказа. Продавец попадает в бан и может быть возвращен при внесении штрафа.

# TO DO
- [ ] отрисовать ER (атрибуты)
- [ ] список системных действий (API и параметры)
- [ ] схема микросервисов
- [ ] канвас по описанию микросервисов

# Системная операция
| Действующее лицо | История | Команда | Описание |
| ---- | ---- | ---- | ---- |
| Покупатель, продавец, оценщик | Регистрация |  | Логин, Пароль, Личные данные (user_info) |
| Покупатель, продавец, оценщик | Авторизация |  | Логин, Пароль |
| Продавец | Размещение товара для продажи | Создать карточку товара | Описание, минимальная цена, ожидаемая цена |
|  |  | Редактировать карточку товара |  |
|  |  | Добавить вложение | Фотографии и другие документы |
|  |  | Удалить вложение |  |
| Продавец | Отправка товара на оценку | Получить список экспертов для оценки |  |
|  |  | Отправить на оценку | лот и выбранный эксперт |
| Покупатель, продавец, оценщик | Коммуникация | Получить чат с пользователем | пользователь, лот |
|  |  | Отправить сообщение | пользователь, лот |
|  |  | Получить сообщение | пользователь, лот |
| Покупатель | Поиск товара для покупки | Найти товар | Поисковая строк |
|  |  | Открыть карточку товара | лот |
| Покупатель | Размещение заявки на товар | Разместить заявку | лот, желаемая стоимость, максимальная стоимость |
| Покупатель | Отзыв заявки на товар | Изменить заявку | лот, желаемая стоимость, максимальная стоимость |
|  |  | Отозвать заявку | лот |
| Продавец | Запуск торгов | Отправить заявку на торги | лот, дата начала, продолжительность |
| Аукцион | Запуск торгов | Апрув заявки | лот (запустить процесс без участие аукциона ?) |
|  |  | Старт торгов | лот |
|  | Закрытие торгов | Остановка торгов | лот |
|  | Выбор победителя | Выбор победителя | лот |
| Покупатель |  | Подтвердить сделку | лот, цена |
| Продавец |  | Подтвердить сделку | лот, цена |
| Покупатель |  | Получить способы доставки | лот, адрес |
| Покупатель |  | Выбрать способ доставки | лот, адрес, способ доставки |
| Продавец |  | Подтвердить доставку | лот, адрес, способ доставки |
| Покупатель |  | Оплатить | Лот,  |

# Диаграмма классов

# Участники
* Продавец (at Клиент) -> реализация Клиента
* Покупатель (at Клиент) ->реализакция Клиента
* Клиент
	* id
	* name
	* contacts
		* email
		* phone
		* \[address\]
	* authentifiaction
		* login
		* password
	* \[roles\]
		* покупатель
		* продавец
		* оценщик

* Оценщик -> реализует клиента / сервис или роль ?/
	* id
	* name
	* portfolio
		* company
		* опыт
		* лицензии
	* \[examples]
	* contact info
		* email
		* phone
		* link
	
* Аукцион (площадка, торги, сделка)
	
	* заявка
		* id lot
		* wanna sum
		* max sum

	* сообщение
		* чат
		* отправитель
		* получатель
		* сообщение
		* дата отправки
		* дата получения
	
* Сервис оплаты
	* способ оплаты
	* сумма
	* плательщик
	* получатель
	* назначения платежа

* Сервис доставки
	* компания доставки
	* способ доставки
	* адрес отправителя 
	* адрес получателя 
	* дата отправки 
	* дата получения 

* Лот
	* \[images\]
	* name
	* description
	* \[documents\]
	* \[resolution\]

